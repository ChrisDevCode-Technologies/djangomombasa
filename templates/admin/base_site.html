{% extends "admin/base.html" %}
{% load static %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | Django Mombasa Admin{% endblock %}

{% block extrastyle %}
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
{% endblock %}

{% block extrahead %}
    <script>
    // Immediately fix theme â€” runs after Django's theme.js (which is in dark-mode-vars block).
    // Normalise "auto" to "light" so only light/dark exist.
    (function() {
        var stored = localStorage.getItem("theme");
        if (stored !== "light" && stored !== "dark") {
            stored = "light";
        }
        localStorage.setItem("theme", stored);
        document.documentElement.dataset.theme = stored;
    })();
    </script>
{% endblock %}

{% block extrabody %}
    <script>
    // Runs at end of <body>, after Django's window.load handler has attached cycleTheme.
    // Replace Django's 3-way cycle with a simple 2-way toggle.
    (function() {
        function toggleTheme() {
            var current = localStorage.getItem("theme") || "light";
            var next = current === "light" ? "dark" : "light";
            document.documentElement.dataset.theme = next;
            localStorage.setItem("theme", next);
        }
        // Clone all toggle buttons to strip Django's cycleTheme listeners, then attach ours.
        document.querySelectorAll(".theme-toggle").forEach(function(btn) {
            var clone = btn.cloneNode(true);
            btn.parentNode.replaceChild(clone, btn);
            clone.addEventListener("click", toggleTheme);
        });
    })();
    </script>
{% endblock %}

{% block branding %}
    <h1 id="site-name">
        <a href="{% url 'admin:index' %}">
            <img src="{% static 'images/logo.jpg' %}" alt="Django Mombasa" class="admin-logo">
            Django Mombasa
        </a>
    </h1>
{% endblock %}

{% block nav-global %}{% endblock %}
